---
layout: post
title:  "웹 파이썬 크롤링"
date:   2019-02-04 16:43:52
author: devAhn
categories: Devlog

---



파이썬 웹 크롤링을 학기중에 제대로 마무리를 못지은게 아쉬워 방중에 다시 시도하고 있다. 


마침 교환학생에 관심이 생겨 학교 국제교류처 홈페이지에 학과별 수기를 찾아보았다. 나랑 관련있는 전자공학과 및 공대 학우분들의 수기가 타학과에 비해서


매우 적었고, 학과 별 검색 필터링이 안되어서 불편했다. 이 문제를 크롤링을 통해 직접 정렬하여 해결해보기로 했다.






***문제상황: 너무 많은 수기, 필터 검색 기능이 없음.***

**원하는 해결: 그 중에 공학계열, 전자공학과 학우분의 수기만 골라서 보고싶음**




### 시작 전 필요한 셋업들이다.(Anaconda 의 Jupyternotebook 기반으로 작성하였다.)

<div class="colorscripter-code" style="color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important; overflow:auto"><table class="colorscripter-code-table" style="margin:0; padding:0; border:none; background-color:#272727; border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px; border-right:2px solid #4f4f4f"><div style="margin:0; padding:0; word-break:normal; text-align:right; color:#aaa; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div></div></td><td style="padding:6px 0"><div style="margin:0; padding:0; color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#0086b3"></span><span style="color:#ff3399">!</span>pip&nbsp;install&nbsp;requests</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;pandas&nbsp;as&nbsp;pd</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;bs4&nbsp;<span style="color:#ff3399">import</span>&nbsp;BeautifulSoup&nbsp;as&nbsp;bs</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">import</span>&nbsp;requests</div></div></td><td style="vertical-align:bottom; padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none; color:white"><span style="font-size:9px; word-break:normal; background-color:#4f4f4f; color:white; border-radius:10px; padding:1px">cs</span></a></td></tr></table></div>




아래 라이브러리는 해놓으면 설치진도를 눈으로 확인할 수 있어 에러가 난 것인지 실행하는데 시간이 오래 걸리는 것인지 알 수 있다.




<div class="colorscripter-code" style="color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important; overflow:auto"><table class="colorscripter-code-table" style="margin:0; padding:0; border:none; background-color:#272727; border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px; border-right:2px solid #4f4f4f"><div style="margin:0; padding:0; word-break:normal; text-align:right; color:#aaa; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div></div></td><td style="padding:6px 0"><div style="margin:0; padding:0; color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#0086b3"></span><span style="color:#ff3399">!</span>pip&nbsp;install&nbsp;tqdm</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">from</span>&nbsp;tqdm&nbsp;<span style="color:#ff3399">import</span>&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">*</span></div></div></td><td style="vertical-align:bottom; padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none; color:white"><span style="font-size:9px; word-break:normal; background-color:#4f4f4f; color:white; border-radius:10px; padding:1px">cs</span></a></td></tr></table></div>

반복문에서 for i in tqdm(): 
괄호 밖에 tqdm을 써주면 된다. 아래와 같이 표시됌

<img src=“devahn.github.io/assets/스크린샷 2019-02-04 오후 4.55.06.png" title=“tqdm”>



설명에 앞서 코드 전문을 게시한 후 한 줄씩 설명하겠다.

<div class="colorscripter-code" style="color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important; overflow:auto"><table class="colorscripter-code-table" style="margin:0; padding:0; border:none; background-color:#272727; border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px; border-right:2px solid #4f4f4f"><div style="margin:0; padding:0; word-break:normal; text-align:right; color:#aaa; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div><div style="line-height:130%">19</div><div style="line-height:130%">20</div><div style="line-height:130%">21</div><div style="line-height:130%">22</div><div style="line-height:130%">23</div><div style="line-height:130%">24</div><div style="line-height:130%">25</div><div style="line-height:130%">26</div><div style="line-height:130%">27</div><div style="line-height:130%">28</div><div style="line-height:130%">29</div><div style="line-height:130%">30</div><div style="line-height:130%">31</div><div style="line-height:130%">32</div></div></td><td style="padding:6px 0"><div style="margin:0; padding:0; color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">a<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>[]</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">for</span>&nbsp;i&nbsp;<span style="color:#ff3399">in</span>&nbsp;tqdm(<span style="color:#4be6fa">range</span>(<span style="color:#c10aff">1</span>,<span style="color:#c10aff">100</span>)):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;num<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">str</span>(i)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'http://oiak.khu.ac.kr/program/memoirs.php?'</span><span style="color:#0086b3"></span><span style="color:#ff3399">+</span><span style="color:#ffd500">'page='</span><span style="color:#0086b3"></span><span style="color:#ff3399">+</span>num<span style="color:#0086b3"></span><span style="color:#ff3399">+</span><span style="color:#ffd500">'&amp;perpage=15&amp;b_ex1=&amp;s1=&amp;s2=&amp;b_code=12'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;r<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;requests.get(url)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;r.text</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;soup<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>bs(r.text,<span style="color:#ffd500">'lxml'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;a.extend(soup.findAll(<span style="color:#ffd500">'td'</span>)[<span style="color:#c10aff">2</span>::<span style="color:#c10aff">5</span>])</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">for</span>&nbsp;i&nbsp;<span style="color:#ff3399">in</span>&nbsp;<span style="color:#4be6fa">range</span>(<span style="color:#4be6fa">len</span>(a)):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;a[i]<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>a[i].text</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">url2&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;(<span style="color:#ffd500">'http://oiak.khu.ac.kr/program/memoirs.php?'</span><span style="color:#0086b3"></span><span style="color:#ff3399">+</span><span style="color:#ffd500">'page='</span><span style="color:#0086b3"></span><span style="color:#ff3399">+</span><span style="color:#ffd500">'1'</span><span style="color:#0086b3"></span><span style="color:#ff3399">+</span><span style="color:#ffd500">'&amp;perpage=15&amp;b_ex1=&amp;s1=&amp;s2=&amp;b_code=12'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">r<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;requests.get(url2)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">r.text</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">soup2<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>bs(r.text,<span style="color:#ffd500">'lxml'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">first<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>soup2.findAll(<span style="color:#ffd500">'td'</span>)[<span style="color:#c10aff">0</span>].text</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">first<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">int</span>(first)</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">for</span>&nbsp;i&nbsp;<span style="color:#ff3399">in</span>&nbsp;<span style="color:#4be6fa">range</span>(<span style="color:#4be6fa">len</span>(a)):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">if</span>&nbsp;<span style="color:#ffd500">'전자'</span>&nbsp;<span style="color:#ff3399">in</span>&nbsp;a[i]:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">print</span>(a[i],first<span style="color:#0086b3"></span><span style="color:#ff3399">-</span>i)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div></div><div style="text-align:right; margin-top:-13px; margin-right:5px; font-size:9px; font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#4f4f4f; text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom; padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none; color:white"><span style="font-size:9px; word-break:normal; background-color:#4f4f4f; color:white; border-radius:10px; padding:1px">cs</span></a></td></tr></table></div>

a=[] # 빈 리스트를 만들어준다. 나중에 리스트에 내가 원하는 값을 넣어주기 위해서.

url = 'http://oiak.khu.ac.kr/program/memoirs.php?'+'page='+num+'&perpage=15&b_ex1=&s1=&s2=&b_code=12'
    
r= requests.get(url) #url의 모든 정보를 모듈을 통해 불러오고,

r.text # 그 url의 모든 정보를 난잡한 형태로 불러온다. 

soup=bs(r.text,'lxml') # 태그별로 깔끔하게 정리해서 lxml, html 형식으로 soup에 넣어준다.

a.extend(soup.findAll('td')[2::5]) # soup.findAll('td')는 td태그를 모두 불러와 리스트 형식으로 저장한다.


  ''' 두번째꺼부터 5칸 간격으로 소속대학 및 학과가 나오길래 [2::5] 로 처리하였다.'''
  
 수기는 매일 갖다오는 학생들이 적으므로 업데이트 된다. 내가 처음 짠 코드는 내가 직접 첫번쨰 값의 번호를 입력해줘야했다. 만들고 나니 욕심이 생겨 첫 번쨰 수기의 순서를 자동으로 받아오게 하고 싶어 뒤 부분을 추가 수정 하였다.
 
url2 = 'http://oiak.khu.ac.kr/program/memoirs.php?'+'page='+'1'+'&perpage=15&b_ex1=&s1=&s2=&b_code=12'
  
 .# 사이트가 매일 업데이트 되므로
  
r= requests.get(url2)

 .# 위와 같이 request.get 으로 아까와 동일하게 페이지 정보를 갖고오고.
 
r.text
soup=bs(r.text,'lxml')
first=soup.findAll('td')[0].text #여기서 첫번쨰 수기의 번호를 자동으로 가져오게 했다.
first=int(first)


for i in range(len(a)):
    if '전자' in a[i]:
        print(a[i],first-i) # '전자' 가 포함된 항목만 걸러내도록 하였다.
         
다음이 결과 값이다. 

![스크린샷 2019-02-04 오후 8.47.22.png](/Users/bigfootboy24-mac/Desktop/스크린샷 2019-02-04 오후 8.47.22.png)


        
 ###### 이런 식으로 결과값으로 내가 원하는 값인 '전자공학과와 해당 글의 번호' 가 함께 출력되도록 하였다.
 
 여기까지가 첫번쨰 마무리였다. 만들고 보니 내가 직접 1366까지 페이지를 넘기며 가야해서 더 편리한, 쉬운 방법을 찾으려고 해봤다. 
 **개별 링크를 보여주면 더 편하겟네!**
라는 생각이 들었고 바로 실행에 옮겼다.  
<div class="colorscripter-code" style="color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important; overflow:auto"><table class="colorscripter-code-table" style="margin:0; padding:0; border:none; background-color:#272727; border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px; border-right:2px solid #4f4f4f"><div style="margin:0; padding:0; word-break:normal; text-align:right; color:#aaa; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div><div style="line-height:130%">19</div></div></td><td style="padding:6px 0"><div style="margin:0; padding:0; color:#f0f0f0; font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">b<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>[]</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">for</span>&nbsp;i&nbsp;<span style="color:#ff3399">in</span>&nbsp;tqdm(<span style="color:#4be6fa">range</span>(<span style="color:#c10aff">1</span>,<span style="color:#c10aff">20</span>)):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;num<span style="color:#0086b3"></span><span style="color:#ff3399">=</span><span style="color:#4be6fa">str</span>(i)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#ffd500">'http://oiak.khu.ac.kr/program/memoirs.php?'</span><span style="color:#0086b3"></span><span style="color:#ff3399">+</span><span style="color:#ffd500">'page='</span><span style="color:#0086b3"></span><span style="color:#ff3399">+</span>num<span style="color:#0086b3"></span><span style="color:#ff3399">+</span><span style="color:#ffd500">'&amp;perpage=15&amp;b_ex1=&amp;s1=&amp;s2=&amp;b_code=12'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;r<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>&nbsp;requests.get(url)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;r.text</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;soup<span style="color:#0086b3"></span><span style="color:#ff3399">=</span>bs(r.text,<span style="color:#ffd500">'lxml'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;b.extend(soup.findAll(<span style="color:#ffd500">'td'</span>,{<span style="color:#ffd500">'class'</span>:<span style="color:#ffd500">'title'</span>}))</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#href=True))</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#{'class':'title'}))</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">#반복문은&nbsp;수행만&nbsp;할뿐&nbsp;저장하지&nbsp;않는다.&nbsp;처음에&nbsp;어떤&nbsp;에러가&nbsp;생겼었는지&nbsp;잘생각해보기&nbsp;반복만&nbsp;하고&nbsp;저장은&nbsp;안하니까</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">#그냥&nbsp;마지막&nbsp;값을&nbsp;출력한거야.&nbsp;</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div></div><div style="text-align:right; margin-top:-13px; margin-right:5px; font-size:9px; font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#4f4f4f; text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom; padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none; color:white"><span style="font-size:9px; word-break:normal; background-color:#4f4f4f; color:white; border-radius:10px; padding:1px">cs</span></a></td></tr></table></div>
 
 
 처음에 링크를 하나만 뽑아주는 내 의도와 다른 결과가 계속 나왔었다. 여기서 내가 잘못 생각한 것은 *반복문은 시행만 여러번 할뿐 저장은 하지 않는 다*는 점이었다. 이 부분을 다음에 수정할 계획이다. 다음 포스팅에서 계속 하겠다. 
 
 공부와 떨어진 ***정말 내가 필요해서 짠*** 첫번째 코드 결과물이라 뿌듯했다. 
 
 가고싶은 분야는 자동차 및 로봇이지만 WEB과 Data 다루는 능력은 가끔 하기 재밌을 거 같아 틈틈이 하려고 한다. :)
